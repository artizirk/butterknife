Butterknife provisioning suite
==============================

Butterknife makes Linux deployment dead-simple using the Btrfs filesystem
and LXC containers.

Installation
------------

First set up machine with Ubuntu 14.04 LTS on top of btrfs filesystem to 
be used as snapshot server.

Before doing any filesystem magic ensure that you're running 3.16+ kernel.
You can install Ubuntu 14.10 kernel on 14.04 simply by doing following:

    apt-get install linux-image-generic-lts-utopic


The workflow
------------

Create LXC container to be used as template for deployment, for instance to 
set up Ubuntu 14.04 container use:

    lxc-create -n your-template -B btrfs -t ubuntu -- -r trusty -a amd64

Use your favourite configuration management tool to customize the container,
eg for Puppet users:

    puppet apply /etc/puppet/manifests/site.pp

Or just install and tweak whatever you need manually.
To get a working Ubuntu 14.04 desktop install the corresponding metapackage,
this of course contains a lot of useless stuff if you're planning to manage the
image by yourself eg apport, update-notifier etc.

    lxc-attach -n your-template
    apt-get update
    apt-get install ubuntu-desktop

Copy post-deploy, pre-release scripts and other helpers:

    rsync -av path/to/butterknife/template/overlay/ /var/lib/lxc/your-template/rootfs/

Use butterknife to take a snapshot of the LXC container:

    butterknife-release -n your-template
